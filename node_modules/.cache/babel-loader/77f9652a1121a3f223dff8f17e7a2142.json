{"ast":null,"code":"import SplitCacheInMemory from './SplitCache/InMemory';\nimport SplitCacheInLocalStorage from './SplitCache/InLocalStorage';\nimport SegmentCacheInMemory from './SegmentCache/InMemory';\nimport SegmentCacheInLocalStorage from './SegmentCache/InLocalStorage';\nimport ImpressionsCacheInMemory from './ImpressionsCache/InMemory';\nimport LatencyCacheInMemory from './LatencyCache/InMemory';\nimport CountCacheInMemory from './CountCache/InMemory';\nimport EventsCacheInMemory from './EventsCache/InMemory';\nimport KeyBuilder from './Keys';\nimport KeyBuilderLocalStorage from './KeysLocalStorage';\nimport { STORAGE_MEMORY, STORAGE_LOCALSTORAGE } from '../utils/constants';\n\nvar BrowserStorageFactory = function BrowserStorageFactory(context) {\n  var settings = context.get(context.constants.SETTINGS);\n  var storage = settings.storage;\n\n  switch (storage.type) {\n    case STORAGE_MEMORY:\n      {\n        var keys = new KeyBuilder(settings);\n        return {\n          splits: new SplitCacheInMemory(),\n          segments: new SegmentCacheInMemory(keys),\n          impressions: new ImpressionsCacheInMemory(),\n          metrics: new LatencyCacheInMemory(),\n          count: new CountCacheInMemory(),\n          events: new EventsCacheInMemory(context),\n          // When using shared instanciation with MEMORY we reuse everything but segments (they are customer per key).\n          shared: function shared(settings) {\n            var childKeyBuilder = new KeyBuilder(settings);\n            return {\n              splits: this.splits,\n              segments: new SegmentCacheInMemory(childKeyBuilder),\n              impressions: this.impressions,\n              metrics: this.metrics,\n              count: this.count,\n              events: this.events,\n              destroy: function destroy() {\n                this.splits = new SplitCacheInMemory();\n                this.segments.flush();\n              }\n            };\n          },\n          destroy: function destroy() {\n            this.splits.flush();\n            this.segments.flush();\n            this.impressions.clear();\n            this.metrics.clear();\n            this.count.clear();\n            this.events.clear();\n          }\n        };\n      }\n\n    case STORAGE_LOCALSTORAGE:\n      {\n        var _keys = new KeyBuilderLocalStorage(settings);\n\n        return {\n          splits: new SplitCacheInLocalStorage(_keys),\n          segments: new SegmentCacheInLocalStorage(_keys),\n          impressions: new ImpressionsCacheInMemory(),\n          metrics: new LatencyCacheInMemory(),\n          count: new CountCacheInMemory(),\n          events: new EventsCacheInMemory(context),\n          // When using shared instanciation with MEMORY we reuse everything but segments (they are customer per key).\n          shared: function shared(settings) {\n            var childKeysBuilder = new KeyBuilderLocalStorage(settings);\n            return {\n              splits: this.splits,\n              segments: new SegmentCacheInLocalStorage(childKeysBuilder),\n              impressions: this.impressions,\n              metrics: this.metrics,\n              count: this.count,\n              events: this.events,\n              destroy: function destroy() {\n                this.splits = new SplitCacheInMemory();\n                this.segments = new SegmentCacheInMemory(childKeysBuilder);\n              }\n            };\n          },\n          destroy: function destroy() {\n            this.splits = new SplitCacheInMemory();\n            this.segments = new SegmentCacheInMemory(new KeyBuilder(settings));\n            this.impressions.clear();\n            this.metrics.clear();\n            this.count.clear();\n            this.events.clear();\n          }\n        };\n      }\n\n    default:\n      throw new Error('Unsupported storage type');\n  }\n};\n\nexport default BrowserStorageFactory;","map":{"version":3,"sources":["/Users/talianassi/node_modules/@splitsoftware/splitio/es/storage/browser.js"],"names":["SplitCacheInMemory","SplitCacheInLocalStorage","SegmentCacheInMemory","SegmentCacheInLocalStorage","ImpressionsCacheInMemory","LatencyCacheInMemory","CountCacheInMemory","EventsCacheInMemory","KeyBuilder","KeyBuilderLocalStorage","STORAGE_MEMORY","STORAGE_LOCALSTORAGE","BrowserStorageFactory","context","settings","get","constants","SETTINGS","storage","type","keys","splits","segments","impressions","metrics","count","events","shared","childKeyBuilder","destroy","flush","clear","_keys","childKeysBuilder","Error"],"mappings":"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","sourcesContent":["import SplitCacheInMemory from './SplitCache/InMemory';\nimport SplitCacheInLocalStorage from './SplitCache/InLocalStorage';\nimport SegmentCacheInMemory from './SegmentCache/InMemory';\nimport SegmentCacheInLocalStorage from './SegmentCache/InLocalStorage';\nimport ImpressionsCacheInMemory from './ImpressionsCache/InMemory';\nimport LatencyCacheInMemory from './LatencyCache/InMemory';\nimport CountCacheInMemory from './CountCache/InMemory';\nimport EventsCacheInMemory from './EventsCache/InMemory';\nimport KeyBuilder from './Keys';\nimport KeyBuilderLocalStorage from './KeysLocalStorage';\nimport { STORAGE_MEMORY, STORAGE_LOCALSTORAGE } from '../utils/constants';\n\nvar BrowserStorageFactory = function BrowserStorageFactory(context) {\n  var settings = context.get(context.constants.SETTINGS);\n  var storage = settings.storage;\n\n  switch (storage.type) {\n    case STORAGE_MEMORY:\n      {\n        var keys = new KeyBuilder(settings);\n        return {\n          splits: new SplitCacheInMemory(),\n          segments: new SegmentCacheInMemory(keys),\n          impressions: new ImpressionsCacheInMemory(),\n          metrics: new LatencyCacheInMemory(),\n          count: new CountCacheInMemory(),\n          events: new EventsCacheInMemory(context),\n          // When using shared instanciation with MEMORY we reuse everything but segments (they are customer per key).\n          shared: function shared(settings) {\n            var childKeyBuilder = new KeyBuilder(settings);\n            return {\n              splits: this.splits,\n              segments: new SegmentCacheInMemory(childKeyBuilder),\n              impressions: this.impressions,\n              metrics: this.metrics,\n              count: this.count,\n              events: this.events,\n              destroy: function destroy() {\n                this.splits = new SplitCacheInMemory();\n                this.segments.flush();\n              }\n            };\n          },\n          destroy: function destroy() {\n            this.splits.flush();\n            this.segments.flush();\n            this.impressions.clear();\n            this.metrics.clear();\n            this.count.clear();\n            this.events.clear();\n          }\n        };\n      }\n\n    case STORAGE_LOCALSTORAGE:\n      {\n        var _keys = new KeyBuilderLocalStorage(settings);\n\n        return {\n          splits: new SplitCacheInLocalStorage(_keys),\n          segments: new SegmentCacheInLocalStorage(_keys),\n          impressions: new ImpressionsCacheInMemory(),\n          metrics: new LatencyCacheInMemory(),\n          count: new CountCacheInMemory(),\n          events: new EventsCacheInMemory(context),\n          // When using shared instanciation with MEMORY we reuse everything but segments (they are customer per key).\n          shared: function shared(settings) {\n            var childKeysBuilder = new KeyBuilderLocalStorage(settings);\n            return {\n              splits: this.splits,\n              segments: new SegmentCacheInLocalStorage(childKeysBuilder),\n              impressions: this.impressions,\n              metrics: this.metrics,\n              count: this.count,\n              events: this.events,\n              destroy: function destroy() {\n                this.splits = new SplitCacheInMemory();\n                this.segments = new SegmentCacheInMemory(childKeysBuilder);\n              }\n            };\n          },\n          destroy: function destroy() {\n            this.splits = new SplitCacheInMemory();\n            this.segments = new SegmentCacheInMemory(new KeyBuilder(settings));\n            this.impressions.clear();\n            this.metrics.clear();\n            this.count.clear();\n            this.events.clear();\n          }\n        };\n      }\n\n    default:\n      throw new Error('Unsupported storage type');\n  }\n};\n\nexport default BrowserStorageFactory;"]},"metadata":{},"sourceType":"module"}